name: Deploy

on: 
  release:
    types:
      - prereleased

jobs:
  setup:
    runs-on: ubuntu-latest
    outputs:
      package_version: ${{ steps.get_pkg_version.outputs.package_version }}
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v2

      - name: Get package version
        id: get_pkg_version
        run: |
          TAG_VERSION=$(echo ${{ github.ref }} | cut -d "/" -f 3)
          PKG_VERSION=${TAG_VERSION:1}

          echo "::set-output name=package_version::$PKG_VERSION"


  linux:
    runs-on: ubuntu-latest
    needs: setup
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v2

      #- name: Install Snap
      #  uses: samuelmeuli/action-snapcraft@v1
      #  with:
      #    snapcraft_token: ${{ secrets.SNAP_TOKEN }}

      #- name: Get snap release asset
      #  uses: dsaltares/fetch-gh-release-asset@master
      #  with:
      #    version: ${{ github.ref }}
      #    file: 

      - name: testing
        run: |
          echo "PKG_VERSION=$PKG_VERSION"
        env:
          PKG_VERSION: ${{ needs.setup.package_version }}

      #- name: Deploy to Snap Store
      #  run: |
      #    snapcraft upload dist/bitwarden_${{ env.PACKAGE_VERSION }}_amd64.snap --release stable
      #    snapcraft logout

